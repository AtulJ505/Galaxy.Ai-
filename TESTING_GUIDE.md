# Testing & Verification Guide

## Step-by-Step Testing Workflow

### Prerequisites
- âœ… App is running at `http://localhost:3000`
- âœ… Database is connected (run `npx prisma db push` successfully)
- âœ… You're signed in (Clerk authentication working)

---

## Test 1: Basic Node Creation & Canvas Navigation

### Steps:
1. **Open the app** - Should see the workflow canvas with left and right sidebars
2. **Test left sidebar:**
   - Click to collapse/expand the sidebar
   - Verify all 6 node buttons are visible:
     - Text Node
     - Upload Image
     - Upload Video
     - Run Any LLM
     - Crop Image
     - Extract Frame

3. **Add a Text Node:**
   - Click "Text Node" button in left sidebar
   - A text node should appear on the canvas
   - Click on the node
   - Type some text: `"Hello, this is a test workflow"`
   - Verify the text is saved in the node

**Expected Result:** âœ… Text node created and editable

---

## Test 2: Image Upload & Preview

### Steps:
1. **Add Upload Image Node:**
   - Click "Upload Image" button
   - Node appears on canvas

2. **Upload an Image:**
   - Click "Click to upload" area in the node
   - Select an image file (jpg, png, webp, or gif)
   - Wait for upload to complete

**Expected Result:** 
- âœ… Image preview appears in the node
- âœ… File name is displayed
- âœ… Output handle is available at the bottom

**Test with different formats:**
- Try uploading: `.jpg`, `.png`, `.webp`, `.gif`
- Verify each format works

---

## Test 3: Video Upload & Preview

### Steps:
1. **Add Upload Video Node:**
   - Click "Upload Video" button
   - Node appears on canvas

2. **Upload a Video:**
   - Click "Click to upload" area
   - Select a video file (mp4, mov, webm, or m4v)
   - Wait for upload

**Expected Result:**
- âœ… Video player appears with controls
- âœ… File name is displayed
- âœ… Output handle available

---

## Test 4: LLM Node - Basic Text Generation

### Steps:
1. **Add LLM Node:**
   - Click "Run Any LLM" button
   - Node appears with model selector and input fields

2. **Configure LLM:**
   - Model: Keep default `gemini-1.5-flash`
   - System Prompt: `"You are a helpful assistant"`
   - User Message: `"Write a short paragraph about artificial intelligence"`

3. **Run LLM:**
   - Click "Run" button
   - Node should show "Running..." with spinner
   - Wait for response (may take a few seconds)

**Expected Result:**
- âœ… Node shows pulsating glow while running
- âœ… Response appears in the node below the button
- âœ… Response is text generated by Gemini

---

## Test 5: Connecting Nodes - Text to LLM

### Steps:
1. **Create Text Node:**
   - Add "Text Node"
   - Type: `"Explain quantum computing in simple terms"`

2. **Create LLM Node:**
   - Add "Run Any LLM" node
   - Set System Prompt manually: `"You are a science teacher"`

3. **Connect Nodes:**
   - Hover over the bottom handle of Text Node (should turn purple)
   - Click and drag to the left handle of LLM Node (labeled "user_message")
   - Connection should be created (purple animated edge)

4. **Verify Connection:**
   - The "User Message" field in LLM Node should become disabled/greyed out
   - This means it's now using the connected Text Node's output

5. **Run LLM:**
   - Click "Run" button on LLM Node
   - It should use the text from the Text Node

**Expected Result:**
- âœ… Connection created successfully
- âœ… User Message field disabled when connected
- âœ… LLM uses connected text for generation

---

## Test 6: Image to LLM - Vision Capability

### Steps:
1. **Create Upload Image Node:**
   - Add "Upload Image"
   - Upload an image (e.g., a photo of a product, artwork, or diagram)

2. **Create LLM Node:**
   - Add "Run Any LLM"
   - System Prompt: `"You are an image analyst. Describe what you see in detail."`
   - User Message: `"What's in this image?"`

3. **Connect Image to LLM:**
   - Drag from Image Node output handle
   - Connect to LLM Node's left handle (labeled "images")
   - The images handle accepts multiple connections

4. **Run LLM:**
   - Click "Run" on LLM Node
   - Wait for response

**Expected Result:**
- âœ… LLM receives the image
- âœ… Response describes or analyzes the image content
- âœ… Vision/multimodal capability working

---

## Test 7: Crop Image Node

### Steps:
1. **Create Upload Image Node:**
   - Upload an image

2. **Create Crop Image Node:**
   - Add "Crop Image" node

3. **Connect or Configure:**
   - **Option A:** Connect Image Node output to Crop Image Node's top handle
   - **Option B:** Manually enter image URL in Crop Image Node

4. **Set Crop Parameters:**
   - X: `10` (10% from left)
   - Y: `10` (10% from top)
   - Width: `80` (80% width)
   - Height: `80` (80% height)

5. **Run Crop:**
   - Click "Crop" button
   - Wait for processing

**Expected Result:**
- âœ… Cropped image preview appears in the node
- âœ… Output URL is available
- âœ… Can connect cropped image to other nodes

---

## Test 8: Extract Frame from Video

### Steps:
1. **Create Upload Video Node:**
   - Upload a video file

2. **Create Extract Frame Node:**
   - Add "Extract Frame" node

3. **Connect Video to Extract Frame:**
   - Connect Video Node output to Extract Frame Node's top handle

4. **Set Timestamp:**
   - Enter: `"50%"` (extract from middle of video)
   - Or enter: `"30"` (extract at 30 seconds)

5. **Run Extract:**
   - Click "Extract Frame" button
   - Wait for processing

**Expected Result:**
- âœ… Extracted frame image appears in the node
- âœ… Frame is from the specified timestamp/percentage
- âœ… Can use frame as image input for other nodes

---

## Test 9: Complex Workflow - Image + Text to LLM

### Steps:
1. **Create 3 Nodes:**
   - **Text Node 1:** System Prompt: `"You are a marketing expert"`
   - **Text Node 2:** Product Description: `"Wireless headphones with noise cancellation"`
   - **Upload Image Node:** Upload a product image

2. **Create LLM Node:**
   - Add "Run Any LLM" node

3. **Connect Everything:**
   - Text Node 1 â†’ LLM Node (system_prompt handle)
   - Text Node 2 â†’ LLM Node (user_message handle)
   - Image Node â†’ LLM Node (images handle)

4. **Verify Connections:**
   - All three input fields in LLM Node should be greyed out
   - Connections visible on canvas

5. **Run LLM:**
   - Click "Run"
   - Should generate marketing copy using both text and image

**Expected Result:**
- âœ… All connections work
- âœ… LLM combines text and image inputs
- âœ… Response is contextually aware of both

---

## Test 10: Load Sample Workflow

### Steps:
1. **Clear Canvas:**
   - Delete any existing nodes (if any)

2. **Load Sample:**
   - Click "Load Sample" button in the top toolbar
   - Confirm when asked

3. **Verify Sample Loaded:**
   - Should see multiple nodes arranged:
     - Upload Image
     - Crop Image
     - Upload Video
     - Extract Frame
     - Multiple Text Nodes
     - Multiple LLM Nodes
   - Should see connections between nodes

4. **Review Structure:**
   - Two parallel branches (Image processing + Video processing)
   - Convergence point at final LLM Node

**Expected Result:**
- âœ… Sample workflow loads successfully
- âœ… All nodes visible and connected
- âœ… Demonstrates parallel execution pattern

---

## Test 11: Workflow Save/Load

### Steps:
1. **Create a Simple Workflow:**
   - Add Text Node with some text
   - Add LLM Node
   - Connect them

2. **Save Workflow:**
   - Click "Save" button in toolbar
   - Should see success message

3. **Create New Workflow:**
   - Delete all nodes
   - Add different nodes

4. **Load Previous:**
   - Click "Save" again (should save new workflow)
   - Or use Export/Import to test JSON workflow persistence

**Expected Result:**
- âœ… Workflow saves successfully
- âœ… Can load saved workflows
- âœ… Workflow data persists

---

## Test 12: Export/Import Workflow

### Steps:
1. **Create a Workflow:**
   - Add a few nodes and connections

2. **Export:**
   - Click "Export" button
   - JSON file should download

3. **Verify Export:**
   - Open downloaded JSON file
   - Should contain nodes, edges, and viewport data

4. **Import:**
   - Clear canvas
   - Click "Import" button
   - Select the exported JSON file

**Expected Result:**
- âœ… Export downloads JSON file
- âœ… Import loads workflow from JSON
- âœ… All nodes and connections restored

---

## Test 13: Workflow History (Right Sidebar)

### Steps:
1. **Execute a Workflow:**
   - Create a simple workflow (Text â†’ LLM)
   - Click "Run Workflow" in toolbar

2. **Check History:**
   - Open right sidebar (if collapsed)
   - Should see workflow run entry
   - Shows timestamp, status, duration

3. **View Details:**
   - Click on a workflow run
   - Should expand to show node-level execution details
   - Each node shows: status, inputs, outputs, duration

**Expected Result:**
- âœ… History entries appear
- âœ… Can view detailed execution info
- âœ… Shows success/failed status for each node

---

## Test 14: Canvas Interactions

### Steps:
1. **Pan Canvas:**
   - Click and drag on empty canvas area
   - Canvas should move

2. **Zoom:**
   - Use mouse wheel to zoom in/out
   - Or use zoom controls in bottom-left

3. **MiniMap:**
   - Check bottom-right corner
   - Should see minimap showing all nodes
   - Can click on minimap to navigate

4. **Delete Node:**
   - Select a node
   - Press `Delete` or `Backspace` key
   - Node should be removed
   - Connected edges should also be removed

**Expected Result:**
- âœ… All canvas interactions work smoothly
- âœ… MiniMap shows overview
- âœ… Node deletion works

---

## Test 15: Type-Safe Connections

### Steps:
1. **Try Invalid Connection:**
   - Create Image Node
   - Create Text Node
   - Try connecting Image output to Text input
   - Should be blocked or show error

2. **Valid Connections:**
   - Text â†’ Text: Should work
   - Image â†’ Image: Should work
   - Image â†’ URL: Should work

**Expected Result:**
- âœ… Invalid connections are prevented
- âœ… Error message shown for invalid connections
- âœ… Only compatible types can connect

---

## Common Issues & Verification

### If LLM Node doesn't work:
- âœ… Check `GOOGLE_AI_API_KEY` in `.env` is set correctly
- âœ… Verify Gemini API key is valid
- âœ… Check browser console for errors

### If Upload doesn't work:
- âœ… Check Transloadit credentials in `.env`
- âœ… Verify file size limits
- âœ… Check network connectivity

### If Connections don't work:
- âœ… Verify nodes are properly configured
- âœ… Check that handles are visible (purple circles)
- âœ… Try disconnecting and reconnecting

---

## Success Criteria Checklist

- [ ] All 6 node types can be created
- [ ] Text nodes can be edited
- [ ] Image upload works with preview
- [ ] Video upload works with player
- [ ] LLM node generates responses
- [ ] LLM can process images (vision)
- [ ] Nodes can be connected via handles
- [ ] Connected inputs become disabled
- [ ] Workflow can be saved to database
- [ ] Workflow can be exported/imported as JSON
- [ ] Sample workflow loads correctly
- [ ] Canvas navigation (pan/zoom) works
- [ ] History sidebar shows execution records
- [ ] Invalid connections are prevented

---

## Quick Test Workflow Example

**5-Minute Quick Test:**

1. âœ… Load Sample Workflow (Toolbar â†’ Load Sample)
2. âœ… Verify nodes are visible
3. âœ… Upload an image to Image Node
4. âœ… Run the first LLM Node
5. âœ… Check response appears
6. âœ… View workflow history (Right sidebar)

If all these work, your basic setup is functioning! ðŸŽ‰
